<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Simple Xsec World">
<meta property="og:url" content="https://xsec.7ever.cn/page/3/index.html">
<meta property="og:site_name" content="Simple Xsec World">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simple Xsec World">



  <link rel="alternate" href="/atom.xml" title="Simple Xsec World" type="application/atom+xml">




  <link rel="canonical" href="https://xsec.7ever.cn/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Simple Xsec World</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Simple Xsec World</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">106</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">10</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">87</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

  <a href="https://github.com/py4maya/blogmd" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xsec.7ever.cn/2019/04/12/bash-audit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xingyue">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple Xsec World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/12/bash-audit/" class="post-title-link" itemprop="url">shell 命令审计</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-12 08:52:41 / Modified: 09:03:03" itemprop="dateCreated datePublished" datetime="2019-04-12T08:52:41+08:00">2019-04-12</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/审计/" itemprop="url" rel="index"><span itemprop="name">审计</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="提前看"><a href="#提前看" class="headerlink" title="提前看:"></a>提前看:</h3><ul>
<li>.bash版本至少3.00或以上</li>
<li>接受审计的登录用户默认shell必须为bash</li>
</ul>
<p>配置方法，使用history ，添加固定的 PROMPT_COMMAND 命令格式, HISTTIMEFORMAT 设置history 的格式。<br>(如果其他的shell 也支持类似的变量，也可以用类似的方法解决)</p>
<h3 id="创建所需文件，及权限限制修改"><a href="#创建所需文件，及权限限制修改" class="headerlink" title="创建所需文件，及权限限制修改:"></a>创建所需文件，及权限限制修改:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/log/shell_audit</span><br><span class="line">touch /var/log/shell_audit/audit.log</span><br><span class="line">chown nobody:nobody /var/log/shell_audit/audit.log</span><br><span class="line">chmod 002 /var/log/shell_audit/audit.log</span><br><span class="line">chattr +a /var/log/shell_audit/audit.log</span><br></pre></td></tr></table></figure>
<h3 id="提前设置history-的相关设置"><a href="#提前设置history-的相关设置" class="headerlink" title="提前设置history 的相关设置:"></a>提前设置history 的相关设置:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 添加如下内容到 bashrc ,保证用户登录及生效</span><br><span class="line">HISTSIZE=2048</span><br><span class="line">HISTTIMEFORMAT="%Y/%m/%d %T   ";export HISTTIMEFORMAT</span><br><span class="line">export HISTORY_FILE=/var/log/shell_audit/audit.log</span><br><span class="line">export PROMPT_COMMAND='&#123; code=$?;thisHistID=`history 1|awk "&#123;print \\$1&#125;"`;lastCommand=`history 1| awk "&#123;\\$1=\"\" ;print&#125;"`;user=`id -un`;whoStr=(`who -u am i`);realUser=$&#123;whoStr[0]&#125;;logDay=$&#123;whoStr[2]&#125;;logTime=$&#123;whoStr[3]&#125;;pid=$&#123;whoStr[5]&#125;;ip=$&#123;whoStr[6]&#125;;if [ $&#123;thisHistID&#125;x != $&#123;lastHistID&#125;x ];then echo -E `date "+%Y/%m/%d %H:%M:%S"` $user\($realUser\)@$ip[PID:$pid][LOGIN:$logDay $logTime] --- [$PWD]$lastCommand [$code];lastHistID=$thisHistID;fi; &#125; &gt;&gt; $HISTORY_FILE'</span><br></pre></td></tr></table></figure>
<h3 id="添加相应的logrotate-防止日志过大"><a href="#添加相应的logrotate-防止日志过大" class="headerlink" title="添加相应的logrotate 防止日志过大:"></a>添加相应的logrotate 防止日志过大:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/logrotate.d/shell_audit</span><br><span class="line">/var/log/shell_audit/audit.log &#123;</span><br><span class="line">    weekly</span><br><span class="line">    missingok</span><br><span class="line">    dateext</span><br><span class="line">    rotate 100</span><br><span class="line">    sharedscripts</span><br><span class="line">    prerotate</span><br><span class="line">    /usr/bin/chattr -a /var/log/shell_audit/audit.log</span><br><span class="line">    endscript</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">      /bin/touch /var/log/shell_audit/audit.log</span><br><span class="line">      /bin/chmod 002 /var/log/shell_audit/audit.log</span><br><span class="line">      /bin/chown nobody:nobody /var/log/shell_audit/audit.log</span><br><span class="line">      /usr/bin/chattr +a /var/log/shell_audit/audit.log</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="还可以配合rsyslog-传输到-集中的命令日志服务器-添加实时审计监控"><a href="#还可以配合rsyslog-传输到-集中的命令日志服务器-添加实时审计监控" class="headerlink" title="还可以配合rsyslog 传输到 集中的命令日志服务器,添加实时审计监控:"></a>还可以配合rsyslog 传输到 集中的命令日志服务器,添加实时审计监控:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ruleset(name="rule_rsyslog") &#123;</span><br><span class="line">    action(type="omfwd"</span><br><span class="line">        Protocol="udp"</span><br><span class="line">        Target="10.211.101.93"</span><br><span class="line">        Port="521")</span><br><span class="line">    stop</span><br><span class="line">&#125;</span><br><span class="line">input(</span><br><span class="line">    type="imfile"</span><br><span class="line">    File="/var/log/shell_audit/audit.log"</span><br><span class="line">    Facility="user"</span><br><span class="line">    Severity="notice"</span><br><span class="line">    Tag=""</span><br><span class="line">    PersistStateInterval="1"</span><br><span class="line">    Ruleset="rule_rsyslog"</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xsec.7ever.cn/2019/04/03/yaf-use-module/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xingyue">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple Xsec World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/03/yaf-use-module/" class="post-title-link" itemprop="url">yaf 控制器分层处理</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-03 14:48:48" itemprop="dateCreated datePublished" datetime="2019-04-03T14:48:48+08:00">2019-04-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-28 15:24:16" itemprop="dateModified" datetime="2019-04-28T15:24:16+08:00">2019-04-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/开发/" itemprop="url" rel="index"><span itemprop="name">开发</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>主要分两个处理办法:</p>
<h2 id="分模块处理"><a href="#分模块处理" class="headerlink" title="分模块处理:"></a>分模块处理:</h2><p>配置选项中，添加当前的模块:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application.modules = 'Test,Index'</span><br></pre></td></tr></table></figure>
<p>创建相应的目录:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@hids application]# tree modules/</span><br><span class="line">modules/</span><br><span class="line">└── Test</span><br><span class="line">    └── controllers</span><br><span class="line">        └── Hello.php</span><br><span class="line"></span><br><span class="line">2 directories, 1 file</span><br></pre></td></tr></table></figure>
<p>访问地址:<br><a href="http://yourhost/prefix/test/hello/world" target="_blank" rel="noopener">http://yourhost/prefix/test/hello/world</a></p>
<ul>
<li>注: 地址去掉prefix 以后超过三段，才会去识别模块 * </li>
</ul>
<h2 id="分文件夹存储"><a href="#分文件夹存储" class="headerlink" title="分文件夹存储:"></a>分文件夹存储:</h2><p>Controller 中创建对应的文件夹:<br>比如 controllers/Flow/Strategy.php</p>
<p>文件中的类名为 Flow_StrategyController</p>
<p>URL 的访问对应关系: </p>
<ul>
<li><prefix>/flow_strategy/list  -&gt; class listAction 方法</prefix></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xsec.7ever.cn/2019/03/29/kafka-receive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xingyue">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple Xsec World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/29/kafka-receive/" class="post-title-link" itemprop="url">一个空的kafka 接收数据</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-29 13:40:43 / Modified: 13:45:13" itemprop="dateCreated datePublished" datetime="2019-03-29T13:40:43+08:00">2019-03-29</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/开发/" itemprop="url" rel="index"><span itemprop="name">开发</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简单代码实现如下"><a href="#简单代码实现如下" class="headerlink" title="简单代码实现如下:"></a>简单代码实现如下:</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> kafka <span class="keyword">import</span> KafkaConsumer</span><br><span class="line"></span><br><span class="line">consumer = KafkaConsumer(</span><br><span class="line">        <span class="string">'topic-name'</span>,</span><br><span class="line">        bootstrap_servers=<span class="string">'.....com:9092'</span>,</span><br><span class="line">        enable_auto_commit=<span class="keyword">False</span>,</span><br><span class="line">        api_version=(<span class="number">0</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> msg <span class="keyword">in</span> consumer:</span><br><span class="line">    print(msg)</span><br></pre></td></tr></table></figure>
<h2 id="运行监控"><a href="#运行监控" class="headerlink" title="运行监控:"></a>运行监控:</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./tools/kafka_2.10-0.9.0.1/bin/kafka-consumer-offset-checker.sh --group group_name --zookeeper=zookeeper_server --topic yourtopic</span></span><br></pre></td></tr></table></figure>
<h2 id="网卡流量监控"><a href="#网卡流量监控" class="headerlink" title="网卡流量监控:"></a>网卡流量监控:</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sar -n DEV 10</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xsec.7ever.cn/2019/03/24/arts-2019-03-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xingyue">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple Xsec World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/24/arts-2019-03-24/" class="post-title-link" itemprop="url">arts 记录 第0周</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-24 13:04:40 / Modified: 13:05:41" itemprop="dateCreated datePublished" datetime="2019-03-24T13:04:40+08:00">2019-03-24</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/arts/" itemprop="url" rel="index"><span itemprop="name">arts</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="arts-2019-03-18-2019-03-24"><a href="#arts-2019-03-18-2019-03-24" class="headerlink" title="arts 2019-03-18 ~ 2019-03-24"></a>arts 2019-03-18 ~ 2019-03-24</h1><hr>
<h2 id="A-（Algorithm）"><a href="#A-（Algorithm）" class="headerlink" title="A （Algorithm）"></a>A （Algorithm）</h2><ul>
<li>题目如下: </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">给你两个非空的链式队列代表两个非负的整数.</span><br><span class="line">You are given two non-empty linked lists representing two non-negative integers. </span><br><span class="line">位数按照相反的顺序存在队列对应的位置，每一位只包含一位</span><br><span class="line">The digits are stored in reverse order and each of their nodes contain a single digit. </span><br><span class="line">把这两个数字加起来用链式队列的方式返回。</span><br><span class="line">Add the two numbers and return it as a linked list.</span><br><span class="line">你可以假设这两个数字不以0开头，除了0本身。</span><br><span class="line">You may assume the two numbers do not contain any leading zero, except the number 0 itself.</span><br><span class="line"></span><br><span class="line">测试用例：</span><br><span class="line">Example:</span><br><span class="line">输入:</span><br><span class="line">Input: (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4)</span><br><span class="line">输出:</span><br><span class="line">Output: 7 -&gt; 0 -&gt; 8</span><br><span class="line">解释:</span><br><span class="line">Explanation: 342 + 465 = 807.</span><br></pre></td></tr></table></figure>
<ul>
<li>解法如下</li>
</ul>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addTwoNumbers</span><span class="params">(l1 *ListNode, l2 *ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//指针pos1,pos2,resultPos 分别表示队列l1,l2,结果的当前值</span></span><br><span class="line">    <span class="keyword">var</span> pos1 *ListNode = l1</span><br><span class="line">    <span class="keyword">var</span> pos2 *ListNode = l2</span><br><span class="line">    <span class="keyword">var</span> result,resultPos *ListNode</span><br><span class="line">    <span class="comment">// 用来表示进位</span></span><br><span class="line">    <span class="keyword">var</span> plusNumber <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 表示循环条件 l1 不为空，或者 l2 不为空</span></span><br><span class="line">    <span class="keyword">for</span> ; (pos1 != <span class="literal">nil</span> || pos2 != <span class="literal">nil</span> ); &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化结果的第一个元素,并且处理当前循环计算的新元素</span></span><br><span class="line">        <span class="keyword">if</span> resultPos == <span class="literal">nil</span> &#123;</span><br><span class="line">            resultPos = <span class="built_in">new</span>(ListNode)</span><br><span class="line">            result = resultPos</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resultPos.Next = <span class="built_in">new</span>(ListNode)</span><br><span class="line">            resultPos = resultPos.Next</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//多重if条件判断，这段代码比较有意思</span></span><br><span class="line">        <span class="comment">//可以减掉频繁的if为空判断</span></span><br><span class="line">        <span class="keyword">switch</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> pos1 != <span class="literal">nil</span> &amp;&amp; pos2 == <span class="literal">nil</span>:</span><br><span class="line">                 resultPos.Val = pos1.Val + plusNumber</span><br><span class="line">                 pos1 = pos1.Next</span><br><span class="line">            <span class="keyword">case</span> pos1 == <span class="literal">nil</span> &amp;&amp; pos2 != <span class="literal">nil</span>:</span><br><span class="line">                resultPos.Val = pos2.Val + plusNumber</span><br><span class="line">                pos2 = pos2.Next</span><br><span class="line">            <span class="keyword">default</span> :</span><br><span class="line">                resultPos.Val = pos1.Val + pos2.Val + plusNumber</span><br><span class="line">                pos1 = pos1.Next</span><br><span class="line">                pos2 = pos2.Next</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重新设置进位，plusNumber 一定要归零</span></span><br><span class="line">        plusNumber = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> resultPos.Val &gt; <span class="number">9</span> &#123;</span><br><span class="line">            plusNumber = resultPos.Val / <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">        resultPos.Val = resultPos.Val % <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//最后如果仍然存在进位，那么添加一个新的元素为1</span></span><br><span class="line">    <span class="keyword">if</span> plusNumber != <span class="number">0</span> &#123;</span><br><span class="line">        resultPos.Next = &amp;ListNode&#123;Val:<span class="number">1</span>,Next:<span class="literal">nil</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="R-Review"><a href="#R-Review" class="headerlink" title="R (Review)"></a>R (Review)</h2><p><a href="https://medium.com/@saginadir/why-i-love-golang-90085898b4f7" target="_blank" rel="noopener">Why I Love Golang</a></p>
<p>文章讲述了一个golang语言爱好者的简单总结。</p>
<ul>
<li>GOPATH 的环境变量:</li>
</ul>
<p>golang 强制把你对go语言的开发，放置到一个叫做GOPATH 的目录里，而不像其他语言那样，可以到处存放。<br>同时也解决了项目迁移的问题，只需要带走整个GOPATH 即可。</p>
<ul>
<li><p>Golang 应用:<br>构造及其简单，只需要打包成main包，然后其中包含一个main 函数 即可</p>
</li>
<li><p>Golang 的模块:<br>Golang 的每一个目录都是一个模块，一个包。就像一个静态类型，所有的成员都像static 。静态变量或者静态方法。<br>但是需要外部调用的方法，首字母必须大写。</p>
</li>
<li><p>Gofmt :<br>golang 还提供了一个格式化代码的工具。省去了大家格式化代码的麻烦，专注于代码本身。<br>（解决了tab,空格问题，大括号问题 O(∩_∩)O哈哈哈~)</p>
</li>
<li><p>Golang 的import:<br>每次引入都是相对于GOPATH/src ，而不像其他语言可以添加自定义的引入目录。<br>这样就不会出现莫名其妙的引入(鬼知道有些包哪里来的)</p>
</li>
<li><p>Go Get 系统:<br>go get 像nodejs 里边的npm 系统。<br>安装一个包的建议命令:<br>go get -v -u # -u 允许更新，-v 显示详细过程</p>
</li>
<li><p>Go的Build 和包系统:<br>GOPATH 其他目录介绍:<br>bin 存放编译好的执行文件<br>pkg 放置编译好的类库文件<br>golang 的编译很快。<br>每一个package 都可以编译成一个对应的静态链接库.a文件 </p>
</li>
<li><p>Golang 的跨平台系统：<br>你不需要去其他的系统上就可以完成跨平台编译:</p>
</li>
<li><p>Goang 语言本身:<br>足够简单的语言，没有的特性:<br>classes<br>Operators overloading<br>Function overloading<br>Optional Parameters<br>exceptions</p>
</li>
<li><p>Golang 语言并发特性：<br>作者觉得这不是golang语言的特性.<br>golang 摒弃了线程，使用更简单的goroutine 。<br>goroutine 允许开发者把任务扔给cpu处理而不必担心怎么管理他们.</p>
</li>
</ul>
<p>一个极简单的并发处理代码:</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data_scan <span class="keyword">chan</span> <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	data_scan = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">128</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scan</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		&lt;-data_scan</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Send</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		data_scan &lt;- <span class="string">"hello send message"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">24</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> Scan()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">24</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> Send()</span><br><span class="line">	&#125;</span><br><span class="line">	time.Sleep(time.Second * <span class="number">120</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="T-（Tip）"><a href="#T-（Tip）" class="headerlink" title="T （Tip）"></a>T （Tip）</h2><p>golang 写一个跨语言调用的so文件:</p>
<p>编译脚本:<br>go build -buildmode=c-shared -ldflags=”-w -s” -o goso.so<br>其中 -ldflags 中可以包含-X a=b -X c=d 在编译时决定变量的值<br>goso.go 的编写，<br>包含一个空的main函数。<br>其中包含的导出函数，添加 export 注释即可以导出:<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"C"</span></span><br><span class="line">    <span class="string">"github.com/v1xingyue/goso/info"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//export BoxHello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BoxHello</span><span class="params">(message \*C.char)</span> \*<span class="title">C</span>.<span class="title">char</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"Hello Box World !"</span>)</span><br><span class="line">    info.Hello()</span><br><span class="line">    fmt.Println(<span class="string">"this is message "</span>,C.GoString(message))</span><br><span class="line">    <span class="keyword">return</span> C.CString(<span class="string">"this is message from golang !"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>具体可以参看goso的项目: <a href="https://github.com/v1xingyue/goso" target="_blank" rel="noopener">goso</a></p>
<h2 id="S-Share"><a href="#S-Share" class="headerlink" title="S (Share)"></a>S (Share)</h2><p>分享几个工作中遇到的问题。</p>
<ul>
<li><ol>
<li>centos 双网卡配置，第一个网卡通，第二个网卡上的IP地址不通。</li>
</ol>
</li>
</ul>
<p>原因是因为,linux 内核的反向路由检测功能。该内核参数为: rp_filter。<br>取值有三种: </p>
<pre><code>* 0 关闭反向路由检测。
* 1 开启严格的路由检测,检测数据包的源地址是否为最佳地址，如果不是直接丢弃
* 2 开启简单的路由检测,检测数据包的反向地址是否可达，如果不可达，直接丢弃。
</code></pre><p>需要将该值设置为0:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> echo 0 &gt; /proc/sys/net/ipv4/conf/all/rp_filter</span><br><span class="line"><span class="meta">$</span> echo 0 &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter </span><br><span class="line"><span class="meta">$</span> echo 0 &gt; /proc/sys/net/ipv4/conf/eth1/rp_filter</span><br></pre></td></tr></table></figure></p>
<ul>
<li>2 使用ipvsadm 搭建一个简单的LVS DR 模式:</li>
</ul>
<p>先简单说下DR模式的数据流向, 从外部设备到 Director Server （包含了vip的机器）,<br>ipvsadm 检测到该ip 是一个集群，那么将该数据包转发到 对应的Rip （真实提供服务的机器）。<br>然后，数据直接从Rip 路由到外部设备。</p>
<p>配置有几个要点:</p>
<p>单网卡绑定多个虚拟地址,（该地址需保持在同一个网段,且不被其他机器占用）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip addr add 10.212.0.129/24 dev eth1</span><br><span class="line"><span class="meta">#</span>## 删除IP 绑定 使用 ip addr del 10.212.0.129/24 dev eth1</span><br></pre></td></tr></table></figure>
<p>简单配置ipvsadm 使用DR 模式:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm -C</span><br><span class="line">ipvsadm -A -t 10.212.0.129:80 -s rr</span><br><span class="line">ipvsadm -a -t 10.212.0.129:80 -r 10.212.0.23:80 ## 添加成员</span><br></pre></td></tr></table></figure>
<p>rip 配置:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VIP=10.212.0.129</span><br><span class="line">ifconfig lo:0 $VIP broadcast $VIP netmask 255.255.255.255 up</span><br><span class="line">route add -host $VIP dev lo:0</span><br></pre></td></tr></table></figure>
<p>这样就完成了简单的LVS 配置: 访问 <a href="http://10.212.0.129" target="_blank" rel="noopener">http://10.212.0.129</a> 就可以路由到 10.212.0.23 上，并且会带了客户端的源IP.</p>
<hr>
<h2 id="还需要arp两个相关的概念"><a href="#还需要arp两个相关的概念" class="headerlink" title="还需要arp两个相关的概念:"></a>还需要arp两个相关的概念:</h2><ul>
<li>arp_ignore参数：</li>
</ul>
<p>设定请求的目标地址为本地ip时，对其arp的查询作不同的应答模式。默认有8个值，我们只使用2个。<br>arp_ignore为0时，表示无论哪块网卡收到arp查询请求，只要本机有此mac地址的网卡，就给予回应。<br>arp_ignore为1时，表示只有请求的mac地址是自己的网卡给予回应。比如一台服务器有两块网卡，其中的一块网卡收arp请求，但是请求的mac是本机的另一块网卡。那么这块网卡就一定不会作出应答。</p>
<ul>
<li>arp_announce参数:</li>
</ul>
<p>设定了网卡在向外部宣告自己IP-MAC时的级别。有3个值。</p>
<p>arp_announce为0时，表示无论哪块网卡收到了arp的请求，只要发现本机有请求的mac，就会响应。<br>arp_announce为1时，表示尽量避免响应ARP请求中MAC不是本网卡的。如一个主机有多块网卡，其中一块网卡接收到了ARP请求，发现所请求的MAC是本机另一块网卡的，这个时候接收到ARP请求的这块网卡就尽量避免响应。<br>arp_announce为2时，表示总是使用最合适的网卡来响应。一个主机有多块网卡，其中一块网卡接收到了ARP请求，发现所请求的MAC是本机另一块网卡的，这个时候接收到ARP请求的这块网卡就一定不响应，只有发现请求的MAC是自己的才给与响应。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://xsec.7ever.cn/2019/03/22/centos-double-card/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Xingyue">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Simple Xsec World">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/22/centos-double-card/" class="post-title-link" itemprop="url">centos 双网卡配置有一个网卡不通</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-22 12:32:47 / Modified: 12:35:00" itemprop="dateCreated datePublished" datetime="2019-03-22T12:32:47+08:00">2019-03-22</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/运维/" itemprop="url" rel="index"><span itemprop="name">运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>根本原因:</p>
<p>Linux默认启用了反向路由检查</p>
<p>如果2个网卡在一个Lan里面,那么服务器可能从eth0或者eth1发现网关, 如果一个包从eth0进入了, 而网关在eth1上, 那么从eth1是出不去的, 就不通了.  反向路由检查要求从哪里来的才能回哪去.</p>
<p>关闭反向路由检查(根据自己的情况替换第二第三行的网卡名):</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/all/rp_filter</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/eth0/rp_filter</span><br><span class="line">echo 0 &gt; /proc/sys/net/ipv4/conf/eth1/rp_filter</span><br></pre></td></tr></table></figure>
<p>每次开机自动关闭反向路由检查, 加入 /etc/rc.local 即可.</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Xingyue</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">87</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">106</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://medium.com/search?q=golang" title="https://medium.com/search?q=golang" rel="noopener" target="_blank">medium</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://coolshell.cn" title="https://coolshell.cn" rel="noopener" target="_blank">coolshell</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/haoel" title="https://github.com/haoel" rel="noopener" target="_blank">haoel</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://wallpaperaccess.com/" title="https://wallpaperaccess.com/" rel="noopener" target="_blank">wallpaper</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xingyue</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.0.1</div>





<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b7122ddb84abef03ea75c5d9160a4e30";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>




  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('Copied');
        else $(this).text('Copy failed');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('Copy');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
